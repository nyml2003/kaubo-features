# Kaubo

Kaubo æ˜¯ä¸€ä¸ªçŽ°ä»£ç¼–ç¨‹è¯­è¨€çš„å®Œæ•´ç¼–è¯‘å™¨å®žçŽ°ï¼Œé‡‡ç”¨ Rust ç¼–å†™ï¼ŒåŒ…å«ç¼–è¯‘å™¨å‰ç«¯ï¼ˆè¯æ³•åˆ†æžã€è¯­æ³•åˆ†æžï¼‰å’Œç¼–è¯‘å™¨åŽç«¯ï¼ˆå­—èŠ‚ç ç”Ÿæˆã€è™šæ‹Ÿæœºæ‰§è¡Œï¼‰ã€‚

## ç‰¹æ€§

- **çŠ¶æ€æœºé©±åŠ¨çš„è¯æ³•åˆ†æžå™¨**ï¼šæ”¯æŒ UTF-8ï¼Œæµå¼è¾“å…¥
- **Pratt è¯­æ³•åˆ†æžå™¨**ï¼šæ”¯æŒè¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§
- **æ ˆå¼å­—èŠ‚ç è™šæ‹Ÿæœº**ï¼šé«˜æ•ˆçš„æŒ‡ä»¤æ‰§è¡Œ
- **NaN Boxing å€¼è¡¨ç¤º**ï¼š7-bit Tag ä¼˜åŒ–ï¼Œæ”¯æŒå†…è”æ•´æ•°
- **ä¸€ç­‰å‡½æ•°**ï¼šLambda å‡½æ•°å®šä¹‰ã€è°ƒç”¨ã€é€’å½’
- **è¿­ä»£å™¨åè®®**ï¼šfor-in å¾ªçŽ¯ï¼Œåˆ—è¡¨å­—é¢é‡

## å¿«é€Ÿå¼€å§‹

### æž„å»ºé¡¹ç›®

```bash
cargo build --release
```

### è¿è¡Œæµ‹è¯•

```bash
cargo test
```

**æµ‹è¯•çŠ¶æ€**: 224 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…

### è¿è¡Œç¤ºä¾‹

```bash
cargo run -- assets/a.txt
```

## æ”¯æŒçš„è¯­æ³•

### åŸºç¡€è¯­æ³•

```kaubo
// å˜é‡å£°æ˜Ž
var x = 5;
var y = x + 3;
return y;
```

### æŽ§åˆ¶æµ

```kaubo
// if/elif/else
if (x > 0) {
    print "positive";
} elif (x < 0) {
    print "negative";
} else {
    print "zero";
}

// while å¾ªçŽ¯
var i = 0;
while (i < 10) {
    print i;
    i = i + 1;
}

// for-in å¾ªçŽ¯
var list = [1, 2, 3, 4, 5];
var sum = 0;
for item in list {
    sum = sum + item;
}
```

### Lambda å‡½æ•°

```kaubo
// æ— å‚æ•°
var greet = || { return "Hello"; };
print greet();

// å¸¦å‚æ•°
var add = |a, b| { return a + b; };
print add(3, 5);  // 8

// é€’å½’
var factorial = |n| {
    if (n <= 1) { return 1; }
    return n * factorial(n - 1);
};
print factorial(5);  // 120
```

### åˆ—è¡¨

```kaubo
// åˆ—è¡¨å­—é¢é‡
var numbers = [1, 2, 3, 4, 5];
var empty = [];

// ç´¢å¼•è®¿é—®
var first = numbers[0];  // 1
```

## æŠ€æœ¯æž¶æž„

```
æºä»£ç  (.kaubo) 
    â†“
Lexer (è¯æ³•åˆ†æž)
    â†“
Parser (è¯­æ³•åˆ†æž, Pratt ç®—æ³•)
    â†“
Compiler (AST â†’ å­—èŠ‚ç )
    â†“
VM (æ ˆå¼è™šæ‹Ÿæœºæ‰§è¡Œ)
    â†“
è¿è¡Œç»“æžœ
```

### NaN Boxing å€¼è¡¨ç¤º

é‡‡ç”¨ 7-bit Tag çš„ NaN Boxing æ–¹æ¡ˆï¼š

```
64-bit å¸ƒå±€:
[63] [62-52] [51] [50-44] [43-0]
  â”‚    â”‚      â”‚     â”‚       â””â”€â”€ Payload (44 bits)
  â”‚    â”‚      â”‚     â””â”€â”€ Tag (7 bits)
  â”‚    â”‚      â””â”€â”€ QNAN æ ‡å¿—
  â”‚    â””â”€â”€ Exponent (11 bits, 0x7FF)
  â””â”€â”€ Sign (1 bit)
```

**ç±»åž‹æ ‡ç­¾**:
- `0`: QNAN
- `1-3`: null, true, false
- `4`: SMI (å°æ•´æ•°, 31-bit)
- `8-23`: å†…è”æ•´æ•° (-8~+7)
- `32+`: å †ç±»åž‹ (String/Function/List/Iterator/Closureé¢„ç•™)

## é¡¹ç›®ç»“æž„

```
src/
â”œâ”€â”€ compiler/           # ç¼–è¯‘å™¨å‰ç«¯
â”‚   â”œâ”€â”€ lexer/          # è¯æ³•åˆ†æžå™¨
â”‚   â””â”€â”€ parser/         # è¯­æ³•åˆ†æžå™¨
â”œâ”€â”€ kit/                # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ lexer/          # é€šç”¨è¯æ³•æ¡†æž¶
â”‚   â””â”€â”€ ring_buffer/    # çŽ¯å½¢ç¼“å†²åŒº
â””â”€â”€ runtime/            # è¿è¡Œæ—¶åŽç«¯
    â”œâ”€â”€ bytecode/       # å­—èŠ‚ç å®šä¹‰
    â”œâ”€â”€ vm.rs           # è™šæ‹Ÿæœº
    â”œâ”€â”€ value.rs        # NaN Boxing å€¼
    â””â”€â”€ compiler.rs     # AST â†’ Bytecode
```

## å¼€å‘è®¡åˆ’

å½“å‰é˜¶æ®µï¼š**Phase 2.3 é—­åŒ…æ”¯æŒ** ðŸš§

### å·²å®Œæˆ

- âœ… è¯æ³•åˆ†æžå™¨ï¼ˆçŠ¶æ€æœºé©±åŠ¨ï¼‰
- âœ… è¯­æ³•åˆ†æžå™¨ï¼ˆPratt è§£æžå™¨ï¼‰
- âœ… å­—èŠ‚ç  VMï¼ˆæ ˆå¼æ‰§è¡Œï¼‰
- âœ… å˜é‡ç³»ç»Ÿï¼ˆå±€éƒ¨å˜é‡ã€èµ‹å€¼ï¼‰
- âœ… æŽ§åˆ¶æµï¼ˆif/while/for-inï¼‰
- âœ… Lambda å‡½æ•°ï¼ˆåŸºç¡€è°ƒç”¨ï¼‰
- âœ… åˆ—è¡¨ä¸Žè¿­ä»£å™¨
- âœ… **é—­åŒ…æ•°æ®ç»“æž„**ï¼ˆObjUpvalue/ObjClosure/æŒ‡ä»¤ï¼‰

### è¿›è¡Œä¸­

- ðŸš§ **é—­åŒ…ç¼–è¯‘å™¨æ”¯æŒ**ï¼ˆå˜é‡æ•èŽ·åˆ†æžï¼‰
- â³ æ¨¡å—ç³»ç»Ÿ
- â³ æ ‡å‡†åº“ï¼ˆBuiltin æ¨¡å—ï¼‰

è¯¦è§ [docs/KAUBO_DESIGN.md](docs/KAUBO_DESIGN.md)

## è®¸å¯è¯

MIT
