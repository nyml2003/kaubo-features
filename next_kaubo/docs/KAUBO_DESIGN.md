# Kaubo ç¼–è¯‘å™¨ - å®Œæ•´è®¾è®¡æ–‡æ¡£

> æœ¬æ–‡æ¡£æ˜¯ Kaubo è¯­è¨€ç¼–è¯‘å™¨çš„å®Œæ•´è®¾è®¡æ–‡æ¡£ï¼Œæ¶µç›–æ¶æ„ã€å®ç°æ–¹æ¡ˆå’Œå¼€å‘è·¯çº¿å›¾ã€‚

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#2-å¿«é€Ÿå¼€å§‹)
3. [æŠ€æœ¯æ¶æ„](#3-æŠ€æœ¯æ¶æ„)
4. [å½“å‰çŠ¶æ€](#4-å½“å‰çŠ¶æ€)
5. [å¼€å‘è·¯çº¿å›¾](#5-å¼€å‘è·¯çº¿å›¾)
6. [å­—èŠ‚ç è®¾è®¡](#6-å­—èŠ‚ç è®¾è®¡)
7. [é«˜çº§ç‰¹æ€§è®¾è®¡](#7-é«˜çº§ç‰¹æ€§è®¾è®¡)
8. [ç±»å‹ç³»ç»Ÿè®¾è®¡](#8-ç±»å‹ç³»ç»Ÿè®¾è®¡)
9. [æµ‹è¯•ä¸è´¨é‡](#9-æµ‹è¯•ä¸è´¨é‡)
10. [å·²çŸ¥é—®é¢˜](#10-å·²çŸ¥é—®é¢˜)

---

## 1. é¡¹ç›®æ¦‚è¿°

**Kaubo** æ˜¯ä¸€ä¸ªç°ä»£ç¼–ç¨‹è¯­è¨€çš„å®Œæ•´ç¼–è¯‘å™¨å®ç°ï¼Œé‡‡ç”¨ Rust ç¼–å†™ï¼ŒåŒ…å«ç¼–è¯‘å™¨å‰ç«¯ï¼ˆè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼‰å’Œç¼–è¯‘å™¨åç«¯ï¼ˆå­—èŠ‚ç ç”Ÿæˆã€è™šæ‹Ÿæœºæ‰§è¡Œï¼‰ã€‚

| å±æ€§ | å€¼ |
|------|-----|
| åç§° | next_kaubo |
| ç‰ˆæœ¬ | 0.1.0 |
| è¯­è¨€ | Rust (Edition 2024) |
| æ¶æ„ | çŠ¶æ€æœº Lexer â†’ Pratt Parser â†’ ç±»å‹æ£€æŸ¥ â†’ å­—èŠ‚ç ç¼–è¯‘ â†’ æ ˆå¼ VM |

### 1.1 é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ main.rs                 # ç¨‹åºå…¥å£
â”œâ”€â”€ lib.rs                  # åº“å¯¼å‡º
â”œâ”€â”€ compiler/               # ç¼–è¯‘å™¨æ¨¡å—ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ lexer/              # Kaubo è¯­è¨€ä¸“ç”¨è¯æ³•åˆ†æå™¨
â”‚   â”‚   â”œâ”€â”€ builder.rs      # Lexer æ„å»ºå™¨
â”‚   â”‚   â””â”€â”€ token_kind.rs   # Token ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ parser/             # è¯­æ³•åˆ†æå™¨
â”‚   â”‚   â”œâ”€â”€ parser.rs       # Pratt è§£æå™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ expr.rs         # è¡¨è¾¾å¼ AST
â”‚   â”‚   â”œâ”€â”€ stmt.rs         # è¯­å¥ AST
â”‚   â”‚   â”œâ”€â”€ module.rs       # æ¨¡å— AST
â”‚   â”‚   â”œâ”€â”€ error.rs        # é”™è¯¯ç±»å‹
â”‚   â”‚   â””â”€â”€ utils.rs        # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ ir/                 # ä¸­é—´è¡¨ç¤ºï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ kit/                    # é€šç”¨å·¥å…·åŒ…ï¼ˆå¯å¤ç”¨ç»„ä»¶ï¼‰
â”‚   â”œâ”€â”€ lexer/              # é€šç”¨è¯æ³•åˆ†ææ¡†æ¶
â”‚   â”‚   â”œâ”€â”€ c_lexer.rs      # é€šç”¨ Lexer å®ç°
â”‚   â”‚   â”œâ”€â”€ types.rs        # Token/Coordinate ç±»å‹
â”‚   â”‚   â””â”€â”€ state_machine/  # çŠ¶æ€æœºæ¡†æ¶
â”‚   â””â”€â”€ ring_buffer/        # ç¯å½¢ç¼“å†²åŒº
â””â”€â”€ runtime/                # è¿è¡Œæ—¶ï¼ˆåç«¯ï¼‰
    â”œâ”€â”€ bytecode/           # å­—èŠ‚ç å®šä¹‰
    â”‚   â”œâ”€â”€ mod.rs          # OpCode å®šä¹‰
    â”‚   â””â”€â”€ chunk.rs        # å­—èŠ‚ç å—
    â”œâ”€â”€ vm.rs               # è™šæ‹Ÿæœºï¼ˆæ ˆå¼æ‰§è¡Œå¼•æ“ï¼‰
    â”œâ”€â”€ value.rs            # NaN Boxing å€¼è¡¨ç¤º
    â””â”€â”€ compiler.rs         # AST â†’ Bytecode ç¼–è¯‘å™¨
```

---

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 æ„å»ºä¸è¿è¡Œ

```bash
# æ„å»ºé¡¹ç›®
cargo build --release

# è¿è¡Œæµ‹è¯•ï¼ˆ211 ä¸ªæµ‹è¯•ï¼‰
cargo test

# è¿è¡Œç¤ºä¾‹ç¨‹åº
cargo run -- assets/a.txt
```

### 2.2 ç¤ºä¾‹ä»£ç 

```kaubo
// å½“å‰æ”¯æŒçš„è¯­æ³•
var x = 5;
var y = x + 3;
return y;  // è¿”å› 8
```

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ•´ä½“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æºä»£ç    â”‚ â†’ â”‚  Lexer  â”‚ â†’ â”‚  Parser â”‚ â†’ â”‚ Compilerâ”‚ â†’ â”‚   VM    â”‚
â”‚  .kaubo â”‚    â”‚  è¯æ³•   â”‚    â”‚  è¯­æ³•   â”‚    â”‚ å­—èŠ‚ç   â”‚    â”‚  æ‰§è¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              AST           Bytecode        è¿è¡Œç»“æœ
```

### 3.2 è¯æ³•åˆ†æå™¨

é‡‡ç”¨**çŠ¶æ€æœºé©±åŠ¨**æ¶æ„ï¼Œæ”¯æŒæµå¼è¾“å…¥å’Œ UTF-8ã€‚

**æ ¸å¿ƒæµç¨‹**:
```
è¾“å…¥å­—èŠ‚æµ â†’ ç¯å½¢ç¼“å†²åŒº â†’ UTF-8è§£ç  â†’ çŠ¶æ€æœºç«äº‰åŒ¹é… â†’ Tokenè¾“å‡º
```

**æ”¯æŒçš„ Token ç±»å‹**:

| ç±»åˆ« | Token |
|------|-------|
| å…³é”®å­— | `var`, `if`, `else`, `elif`, `while`, `for`, `return`, `true`, `false`, `null`, `and`, `or`, `not` ç­‰ |
| å­—é¢é‡ | `LiteralInteger`, `LiteralString` |
| è¿ç®—ç¬¦ | `==`, `!=`, `>=`, `<=`, `>`, `<`, `+`, `-`, `*`, `/`, `=`, `.`, `\|` ç­‰ |
| åˆ†éš”ç¬¦ | `(`, `)`, `{`, `}`, `[`, `]`, `,`, `;`, `:` |

### 3.3 è¯­æ³•åˆ†æå™¨

é‡‡ç”¨ **Pratt è§£æç®—æ³•**ï¼ˆTop-down operator precedenceï¼‰ã€‚

**ä¼˜å…ˆçº§è¡¨**ï¼ˆä»é«˜åˆ°ä½ï¼‰:

| ä¼˜å…ˆçº§ | è¿ç®—ç¬¦ | è¯´æ˜ |
|--------|--------|------|
| 450 | `not` | ä¸€å…ƒé€»è¾‘é |
| 400 | `.` | æˆå‘˜è®¿é—® |
| 300 | `*`, `/` | ä¹˜é™¤ |
| 200 | `+`, `-` | åŠ å‡ |
| 100 | `==`, `!=`, `>`, `<`, `>=`, `<=` | æ¯”è¾ƒ |
| 80 | `and` | é€»è¾‘ä¸ |
| 70 | `\|` | ç®¡é“ |
| 60 | `or` | é€»è¾‘æˆ– |
| 50 | `=` | èµ‹å€¼ |

**AST ç»“æ„**:

```rust
// è¡¨è¾¾å¼
pub enum ExprKind {
    LiteralInt(LiteralInt),       // 42
    LiteralString(LiteralString), // "hello"
    LiteralTrue, LiteralFalse, LiteralNull,
    LiteralList(LiteralList),     // [1, 2, 3]
    Binary(Binary),               // a + b
    Unary(Unary),                 // -a, not b
    Grouping(Grouping),           // (a + b)
    VarRef(VarRef),               // x
    FunctionCall(FunctionCall),   // foo(a, b)
    Assign(Assign),               // x = 5
    Lambda(Lambda),               // |x| { x + 1 }
    MemberAccess(MemberAccess),   // obj.field
}

// è¯­å¥
pub enum StmtKind {
    Expr(ExprStmt),               // a + b;
    Empty,                        // ;
    Block(BlockStmt),             // { ... }
    VarDecl(VarDeclStmt),         // var x = 5;
    If(IfStmt),                   // if/elif/else
    While(WhileStmt),             // while (cond) { ... }
    For(ForStmt),                 // for (i) in (list) { ... }
    Return(ReturnStmt),           // return value;
}
```

### 3.4 ç¼–è¯‘å™¨åç«¯

**ç¼–è¯‘æµç¨‹**:
```
AST â†’ ç±»å‹æ£€æŸ¥ â†’ å­—èŠ‚ç ç¼–è¯‘ â†’ å­—èŠ‚ç å—(Chunk) â†’ VM æ‰§è¡Œ
```

**æ ¸å¿ƒç»„ä»¶**:
- **Type Checker**: ç±»å‹æ£€æŸ¥ä¸æ¨æ–­ï¼ˆPhase 2.7ï¼‰
- **Compiler**: AST åˆ°å­—èŠ‚ç çš„ç¼–è¯‘
- **Chunk**: å­—èŠ‚ç å—ï¼ˆæŒ‡ä»¤ + å¸¸é‡æ±  + è¡Œå·ï¼‰
- **VM**: æ ˆå¼è™šæ‹Ÿæœºï¼ˆå€¼æ ˆ + è°ƒç”¨å¸§æ ˆï¼‰
- **Value**: NaN Boxing å€¼è¡¨ç¤ºï¼ˆSMI + Float + Special + Heapï¼‰

---

## 4. å½“å‰çŠ¶æ€

### 4.1 å·²å®ŒæˆåŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è¯æ³•åˆ†æå™¨ | âœ… | çŠ¶æ€æœºé©±åŠ¨ï¼Œå®Œæ•´ Token æ”¯æŒ |
| è¯­æ³•åˆ†æå™¨ | âœ… | Pratt è§£æå™¨ï¼Œè¡¨è¾¾å¼ + è¯­å¥ |
| å­—èŠ‚ç  VM | âœ… | æ ˆå¼æ‰§è¡Œï¼ŒåŸºç¡€æŒ‡ä»¤é›† |
| å€¼è¡¨ç¤º | âœ… | NaN Boxingï¼ˆSMI/Float/Specialï¼‰|
| å±€éƒ¨å˜é‡ | âœ… | LoadLocal/StoreLocal æŒ‡ä»¤ |
| å˜é‡ç¼–è¯‘ | âœ… | var å£°æ˜ã€è¯»å†™ã€èµ‹å€¼ |

### 4.2 è¿›è¡Œä¸­

**Phase 2.2 W3**: æ§åˆ¶æµç¼–è¯‘ï¼ˆif/while/for/break/continueï¼‰

### 4.3 æµ‹è¯•çŠ¶æ€

- **å•å…ƒæµ‹è¯•**: 211 ä¸ªï¼Œå…¨éƒ¨é€šè¿‡ âœ…
- **è¡Œè¦†ç›–ç‡**: 82.11%

---

## 5. å¼€å‘è·¯çº¿å›¾

### æ•´ä½“è§„åˆ’

```
Phase 1: æµ‹è¯•ä¸ä¿®å¤ âœ… (å·²å®Œæˆ)
    â†“
Phase 2: æ ¸å¿ƒåŠŸèƒ½å®ç° ğŸš§ (è¿›è¡Œä¸­)
    â”œâ”€ 2.2: å˜é‡ç³»ç»Ÿä¸æ§åˆ¶æµ (4å‘¨) - W1-W2 âœ…, W3 ğŸš§
    â”œâ”€ 2.3: é—­åŒ…æ”¯æŒ (3å‘¨) â³
    â”œâ”€ 2.4: åç¨‹ä¸è¿­ä»£å™¨ (4å‘¨) â³
    â”œâ”€ 2.5: Result ç±»å‹ä¸é”™è¯¯å¤„ç† (3å‘¨) â³
    â”œâ”€ 2.6: GC ä¸ä¼˜åŒ– (2å‘¨) â³
    â””â”€ 2.7: ä¸¥æ ¼ç±»å‹ç³»ç»Ÿ (2.5å‘¨) â³
    â†“
Phase 3: åŠŸèƒ½å®Œå–„ï¼ˆè¯­è¨€ç‰¹æ€§ï¼‰â³
    â†“
Phase 4: æ€§èƒ½ä¼˜åŒ–ï¼ˆJITç­‰ï¼‰â³
```

### Phase 2.2: å˜é‡ç³»ç»Ÿä¸æ§åˆ¶æµ (4å‘¨)

| å‘¨æ¬¡ | ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| W1 | å±€éƒ¨å˜é‡è¡¨è®¾è®¡ | âœ… | æ ˆå¸§ç»“æ„ã€LoadLocal/StoreLocal æŒ‡ä»¤ |
| W2 | å˜é‡ç¼–è¯‘ | âœ… | var å£°æ˜ã€å˜é‡è¯»å†™ã€èµ‹å€¼ |
| W3 | æ§åˆ¶æµç¼–è¯‘ | ğŸš§ | if/elif/elseã€while å¾ªç¯ã€break/continue |
| W4 | for-in åŸºç¡€ | â³ | åˆ—è¡¨è¿­ä»£ã€èŒƒå›´è¿­ä»£ |

### Phase 2.3: é—­åŒ…æ”¯æŒ (3å‘¨)

**æ–¹æ¡ˆ**: Lua é£æ ¼ Upvalue ç®€åŒ–ç‰ˆ

- æŒ‰å¼•ç”¨æ•è·ï¼ˆé—­åŒ…å†…ä¿®æ”¹å½±å“å¤–éƒ¨å˜é‡ï¼‰
- ç«‹å³å †åˆ†é…
- `Cell<Value>` å®ç°å†…éƒ¨å¯å˜æ€§

**éªŒæ”¶ä»£ç **:
```kaubo
var x = 5;
var f = || { x = x + 1; return x; };
assert(f() == 6);
assert(x == 6);  // å¤–éƒ¨å˜é‡è¢«ä¿®æ”¹
```

### Phase 2.4: åç¨‹ä¸è¿­ä»£å™¨ (4å‘¨)

**æ–¹æ¡ˆ**: æ ˆå¼åç¨‹ + ç»Ÿä¸€è¿­ä»£å™¨åè®®

- åç¨‹æ ˆåŠ¨æ€å¢é•¿
- Yield/Resume åŒå‘é€šä¿¡
- é”™è¯¯ä¼ æ’­ä½œä¸ºå€¼äº§å‡º

### Phase 2.5: Result ç±»å‹ä¸é”™è¯¯å¤„ç† (3å‘¨)

**æ–¹æ¡ˆ**: Rust é£æ ¼ Resultï¼ˆæ—  `?` æ“ä½œç¬¦ï¼‰

```kaubo
fun divide(a: Int, b: Int) -> Result<Int, String> {
    if (b == 0) {
        return Err("division by zero");
    }
    return Ok(a / b);
}

match divide(10, 2) {
    Ok(v) => print(v),
    Err(e) => print(e),
}
```

### Phase 2.6: GC ä¸ä¼˜åŒ– (2å‘¨)

**æ–¹æ¡ˆ**: æ ‡è®°-æ¸…é™¤ GC

### Phase 2.7: ä¸¥æ ¼ç±»å‹ç³»ç»Ÿ (2.5å‘¨)

**æ ¸å¿ƒåŸåˆ™**:
| ç‰¹æ€§ | å†³ç­– |
|------|------|
| âœ… ç±»å‹æ¨æ–­ | å±€éƒ¨å˜é‡æ”¯æŒ |
| âŒ éšå¼è½¬æ¢ | æ— ï¼Œ`Int` â‰  `Float` |
| âŒ any/Unknown | æ—  |
| âŒ å‡½æ•°é‡è½½ | æ—  |
| âœ… Unit | `()` è¡¨ç¤ºæ— è¿”å›å€¼ |
| âŒ Void | ç”¨ Unit æ›¿ä»£ |
| âœ… Never | æ°¸ä¸è¿”å›ç±»å‹ |
| âŒ null | ç”¨ `Option<T>` æ›¿ä»£ |

---

## 6. å­—èŠ‚ç è®¾è®¡

### 6.1 æŒ‡ä»¤é›†

```rust
pub enum OpCode {
    // å¸¸é‡åŠ è½½ (0x00-0x1F)
    LoadConst0 = 0x00, LoadConst1, ..., LoadConst15,
    LoadConst,           // 0x10 + u8
    LoadConstWide,       // 0x11 + u16
    LoadNull = 0x18, LoadTrue, LoadFalse, LoadZero, LoadOne,

    // æ ˆæ“ä½œ (0x20-0x2F)
    Pop = 0x20, Dup, Swap,

    // å±€éƒ¨å˜é‡ (0x30-0x47)
    LoadLocal0 = 0x30, ..., LoadLocal7,
    LoadLocal,           // 0x38 + u8
    StoreLocal0 = 0x40, ..., StoreLocal7,
    StoreLocal,          // 0x48 + u8

    // ç®—æœ¯è¿ç®— (0x60-0x6F)
    Add = 0x60, Sub, Mul, Div, Neg,

    // æ¯”è¾ƒè¿ç®— (0x70-0x77)
    Equal = 0x70, NotEqual, Greater, GreaterEqual, Less, LessEqual,

    // é€»è¾‘è¿ç®— (0x78-0x7B)
    Not = 0x78,

    // æ§åˆ¶æµ (0x80-0x8F)
    Jump = 0x80, JumpIfFalse, JumpBack,

    // å‡½æ•° (0x90-0x9F)
    Call = 0x90, Return, ReturnValue,

    // è°ƒè¯• (0xF0-0xFF)
    Print = 0xF0, Invalid = 0xFF,
}
```

### 6.2 å€¼è¡¨ç¤ºï¼ˆNaN Boxingï¼‰

```
64-bit å¸ƒå±€:
[63] [62-52] [51-48] [47-0]
  â”‚    â”‚       â”‚       â””â”€â”€ Payload (48 bits)
  â”‚    â”‚       â””â”€â”€ Type tag (3 bits)
  â”‚    â””â”€â”€ Exponent (11 bits)
  â””â”€â”€ Sign (1 bit)

ç±»å‹æ ‡ç­¾:
- 000: SMI (å°æ•´æ•°, -2^30 ~ 2^30-1)
- 001: Heap å¯¹è±¡æŒ‡é’ˆ
- 010: Special (null, true, false, Unit)
- 011+: é¢„ç•™ (Result Ok/Err, Option Some/None)
```

### 6.3 è°ƒç”¨çº¦å®š

```
æ ˆå¸§å¸ƒå±€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† æ ˆé¡¶
â”‚          æ“ä½œæ•°æ ˆ            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å±€éƒ¨å˜é‡ 0 (slot_base)      â”‚
â”‚  å±€éƒ¨å˜é‡ 1                  â”‚
â”‚  ...                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      è¿”å›åœ°å€ / åŸ FP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. é«˜çº§ç‰¹æ€§è®¾è®¡

### 7.1 é—­åŒ…ï¼ˆPhase 2.3ï¼‰

**æ•è·è¯­ä¹‰**: æŒ‰å¼•ç”¨æ•è·

```rust
struct ObjClosure {
    function: *ObjFunction,
    upvalues: Vec<Gc<ObjUpvalue>>,
}

struct ObjUpvalue {
    location: *mut Value,
    closed: Cell<Value>,
}
```

### 7.2 åç¨‹ï¼ˆPhase 2.4ï¼‰

```rust
struct Coroutine {
    stack: Vec<Value>,
    call_stack: Vec<CallFrame>,
    state: CoroState,
}
```

### 7.3 Result ä¸é”™è¯¯å¤„ç†ï¼ˆPhase 2.5ï¼‰

- æ˜¾å¼ Result ç±»å‹
- match è¡¨è¾¾å¼å¤„ç†
- æ—  `?` æ“ä½œç¬¦ï¼ˆå…ˆè·‘é€šåŸºç¡€ï¼‰

---

## 8. ç±»å‹ç³»ç»Ÿè®¾è®¡

### 8.1 è®¾è®¡åŸåˆ™

| ç‰¹æ€§ | å†³ç­– |
|------|------|
| âœ… ç±»å‹æ¨æ–­ | å±€éƒ¨å˜é‡æ”¯æŒ |
| âŒ éšå¼è½¬æ¢ | æ— ï¼Œ`Int` â‰  `Float`ï¼Œå¿…é¡»æ˜¾å¼ `Float(x)` |
| âŒ any/Unknown | æ—  |
| âŒ å‡½æ•°é‡è½½ | æ—  |
| âœ… Unit | `()` è¡¨ç¤ºæ— è¿”å›å€¼ |
| âŒ Void | ç”¨ Unit æ›¿ä»£ |
| âœ… Never | æ°¸ä¸è¿”å›ç±»å‹ |
| âŒ null | ç”¨ `Option<T>` æ›¿ä»£ |

### 8.2 ç±»å‹æ ‡æ³¨è¯­æ³•

```kaubo
// æ˜¾å¼æ ‡æ³¨
var x: Int = 5;

// ç±»å‹æ¨æ–­
var y = 10;  // Int

// å‡½æ•°ç­¾å
fun add(a: Int, b: Int) -> Int {
    return a + b;
}

// Option æ›¿ä»£ null
fun find(nums: List<Int>, target: Int) -> Option<Int> {
    // ...
    return Some(index);
    // æˆ– return None;
}
```

### 8.3 æ— éšå¼è½¬æ¢ç¤ºä¾‹

```kaubo
var i: Int = 5;
var f: Float = i;          // âŒ Error
var f2: Float = Float(i);  // âœ… OK

var sum = i + 3.14;        // âŒ Error
var sum2 = Float(i) + 3.14; // âœ… OK
```

---

## 9. æµ‹è¯•ä¸è´¨é‡

### 9.1 å½“å‰çŠ¶æ€

- **æµ‹è¯•æ•°é‡**: 211 ä¸ª
- **æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡ âœ…
- **è¡Œè¦†ç›–ç‡**: 82.11%

### 9.2 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
cargo make cov
```

### 9.3 æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**: æ¨¡å—åº•éƒ¨å†…è”æµ‹è¯•
- **é›†æˆæµ‹è¯•**: `tests/integration_tests.rs`

---

## 10. å·²çŸ¥é—®é¢˜

### 10.1 åŠŸèƒ½ç¼ºå¤±ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

| ä¼˜å…ˆçº§ | é—®é¢˜ | å·¥ä½œé‡ | æ‰€å± Phase |
|--------|------|--------|-----------|
| ğŸ”´ é«˜ | æ§åˆ¶æµ (if/while/for) | 1å‘¨ | 2.2 W3 |
| ğŸ”´ é«˜ | é—­åŒ… Upvalue | 2å‘¨ | 2.3 |
| ğŸ”´ é«˜ | åç¨‹å®ç° | 3å‘¨ | 2.4 |
| ğŸŸ¡ ä¸­ | Result ç±»å‹ | 2å‘¨ | 2.5 |
| ğŸŸ¡ ä¸­ | æ ‡è®°-æ¸…é™¤ GC | 2å‘¨ | 2.6 |
| ğŸŸ¢ ä½ | ä¸¥æ ¼ç±»å‹ç³»ç»Ÿ | 2.5å‘¨ | 2.7 |

### 10.2 æŠ€æœ¯å€ºåŠ¡

| é—®é¢˜ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| VM è£¸æŒ‡é’ˆ | ä½¿ç”¨ `*const u8` | ä¸­ |
| å­—ç¬¦ä¸²åˆ†é… | æ¯ä¸ª Token æ–°å»º String | ä½ |
| åŠ¨æ€åˆ†å‘ | `Box<dyn Fn(char) -> bool>` | ä½ |

---

## é™„å½•ï¼šæ—¶é—´çº¿

```
å‘¨æ¬¡    1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21
       |--Phase 2.2--|
                      |--Phase 2.3--|
                                     |----Phase 2.4----|
                                                       |--Phase 2.5--|
                                                                      |--2.6--|
                                                                               |--2.7--|

æ€»è®¡: 21 å‘¨ï¼ˆçº¦ 5 ä¸ªæœˆï¼‰
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.1*  
*æœ€åæ›´æ–°: 2026-02-08*  
*é¡¹ç›®çŠ¶æ€: Phase 2.2 W3 è¿›è¡Œä¸­ï¼ˆæ§åˆ¶æµç¼–è¯‘ï¼‰*
