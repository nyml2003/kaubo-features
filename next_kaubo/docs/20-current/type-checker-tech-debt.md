# 类型检查器技术债

> 本文档记录类型系统的已完成功能和待完成任务。

## 已完成功能 ✅

### 1. if/while 条件 bool 检查

**状态**: ✅ 已完成（2026-02-14）

```rust
// 严格模式下检查条件为 bool
if 1 + 2 { ... }  // ❌ 错误：expected "bool", found "int"
```

### 2. 函数调用参数类型检查

**状态**: ✅ 已完成（2026-02-14）

- 检查参数数量匹配
- 检查参数类型兼容
- 支持 `any` 顶层类型

### 3. Struct 字段类型检查

**状态**: ✅ 已完成（2026-02-14）

- 检查字段名存在性
- 检查字段类型匹配
- 支持 struct 字面量类型推导

### 4. 成员访问类型推导

**状态**: ✅ 已完成（2026-02-14）

```kaubo
struct Point { x: float, y: float };
var p = Point { x: 0.0, y: 0.0 };
var x = p.x;  // 正确推导为 float
```

### 5. 类型转换 `as` 表达式

**状态**: ✅ 已完成（2026-02-14）

支持：`int` ↔ `float`, `int` → `string`, `float` → `string`, `bool` → `string`

### 6. `any` 顶层类型

**状态**: ✅ 已完成（2026-02-14）

`any` 可以接受任何类型，用于泛型容器和通用函数。

---

## 未完成的功能

### 1. 列表元素类型检查

**位置**: `check_list_literal`

**现状**: 
- 推导列表类型但不验证元素类型一致性
- `[1, "hello"]` 推导为 `List<any>` 而不是报错

**优先级**: P2

---

### 2. 更丰富的类型转换

**现状**: 仅支持基础类型转换

**待支持**:
- `string` → `int` / `float`（解析）
- `List<T>` → `List<U>`（映射转换）
- 自定义类型转换（trait 支持）

**优先级**: P2

---

### 3. 类型别名

**需求**: 
```kaubo
type Point = { x: float, y: float };
type IntList = List<int>;
```

**优先级**: P3

---

### 4. 联合类型

**需求**:
```kaubo
var x: int | string = 42;  // 可以是 int 或 string
```

**优先级**: P3（需要大量设计工作）

---

## 设计决策记录

### 为什么 `any` 而不是 `unknown`?

最初使用 `unknown`（类似 TypeScript 的语义），但最终选择 `any`：

1. **简单性**: `any` 在类型系统中更常见
2. **实用性**: Kaubo 不是 TypeScript，不需要区分 `any` 和 `unknown`
3. **一致性**: 内置函数使用 `any` 表示泛型（如 `len: |List<any>| -> int`）

### 为什么无隐式转换?

1. **明确性**: 所有转换必须显式，避免意外行为
2. **性能**: 编译时就知道转换点，不需要运行时检查
3. **安全性**: `int` 到 `float` 可能丢失精度，应该显式标记

---

## 相关文档

- [类型系统设计](type-system.md) - 完整类型系统文档
