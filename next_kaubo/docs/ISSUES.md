# 已知问题记录

> 记录当前项目中存在的已知问题和技术债务，供后续迭代参考。

## 功能缺失

### 高优先级

| 问题 | 影响 | 预计工作量 | 备注 |
|------|------|-----------|------|
| 字符串转义 | 无法使用 `"hello\n"` 这类带转义字符的字符串 | 1天 | 需要在 lexer 中处理转义序列 |
| 成员/索引赋值 | 不支持 `obj.x = 5` 或 `arr[0] = 1` | 2天 | 当前 parser 只支持简单变量赋值 |
| 索引访问 | 不支持 `arr[0]` 语法 | 1天 | 需要添加新的表达式类型 |

### 中优先级

| 问题 | 影响 | 预计工作量 | 备注 |
|------|------|-----------|------|
| 浮点数支持 | 只支持整数 | 2天 | 需要修改 lexer 和 value 表示 |
| 错误位置报告 | 错误信息不带行列号 | 3天 | ParserError 需要包含 Coordinate |
| 闭包支持 | Lambda 无法捕获外部变量 | 3天 | 需要环境/作用域设计 |

### 低优先级

| 问题 | 影响 | 预计工作量 | 备注 |
|------|------|-----------|------|
| 复合赋值 | 不支持 `+=`, `-=` 等 | 1天 | 语法糖和 AST 转换 |
| 多行字符串 | 不支持 `"""..."""` | 1天 | 语法扩展 |
| Unicode 标识符 | 标识符只能是 ASCII | 1天 | lexer 字符判断修改 |

---

## 技术债务

### 架构层面

| 问题 | 说明 | 风险 | 解决方案 |
|------|------|------|---------|
| 动态分发 | `Box<dyn Fn(char) -> bool>` 在 lexer 状态机中 | 运行时开销 | 改为函数指针或枚举 |
| 字符串分配 | 每个 Token 都新建 String | 内存开销大 | 考虑字符串 interning |
| AST 内存布局 | `Box<ExprKind>` 带来大量小分配 | 缓存不友好 | 考虑 arena allocator |

### 代码层面

| 文件 | 问题 | 严重程度 |
|------|------|---------|
| `main.rs` | 硬编码路径，无法测试 | 中 |
| `parser.rs` | 错误处理不够细化 | 低 |
| `token_kind.rs` | 大量未使用的 Token 类型 | 低 |

---

## 已修复问题

### Phase 1 修复记录

| 问题 | 位置 | 修复方案 | 状态 |
|------|------|---------|------|
| whitespace 匹配换行 | `builder.rs:125` | `c.is_whitespace()` → `c == ' '` | ✅ |
| 无效 check 调用 | `parser.rs:336` | 经查无此问题，行号已过时 | ✅ |
| 结合性硬编码 | `utils.rs:23` | 已实现正确的结合性判断 | ✅ |

---

## Phase 2 前置依赖

在启动字节码后端之前，建议先解决以下问题：

1. **字符串转义** - 基础功能，影响用户体验
2. **成员赋值** - 语法完整性
3. **错误位置报告** - 调试体验

---

*最后更新: 2026-02-08*
