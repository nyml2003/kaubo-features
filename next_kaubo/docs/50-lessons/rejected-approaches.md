# 已否决的方案

不要重复踩坑。这些方案已被否决，除非复活条件发生。

## 方案：使用Rc<RefCell>管理AST节点

- **状态**：❌ 永久否决
- **尝试时间**：2025-02（分析阶段，未实现）
- **否决原因**：
  - 运行时借用检查开销不可接受
  - 理论估计：每次访问AST节点增加~50ns
  - 编译器需要频繁遍历AST，累积开销过大
- **复活条件**：发现零成本抽象方式（可能性极低）

## 方案：完整垃圾回收（GC）

- **状态**：❌ 当前否决，未来可能复活
- **尝试时间**：2025-02（分析阶段）
- **否决原因**：
  - 在Rust中实现安全GC复杂度超预期
  - 预计增加2000行unsafe代码和复杂生命周期管理
  - 超出complexity-budget.md的维护能力
- **替代方案**：模块级Arena（生命周期与热重载单元对齐）
- **复活条件**：
  - 需要支持>1小时长运行脚本
  - 内存profiling证明Arena导致实际泄漏>100MB

## 方案：LLVM作为JIT后端

- **状态**：⏸️ 搁置（非否决）
- **尝试时间**：2025-02（调研阶段）
- **搁置原因**：
  - 编译速度不满足performance-limits.md的<100ms约束
  - 初始化开销固定~200ms
- **替代方案**：Cranelift（当前）
- **复活条件**：
  - 发现LLVM增量编译方案（如只编译变更函数）
  - 或接受Release模式用LLVM（开发用Cranelift）

## 方案：解释器兜底+后台JIT（分层JIT）

- **状态**：⚠️ 部分采纳，简化版
- **尝试时间**：2025-02（设计阶段）
- **调整原因**：
  - 原方案：解释器先执行，热点检测后后台编译
  - 问题：双模式增加架构复杂度
  - 调整：优先JIT，失败时解释器兜底（非并行）

---

*新增否决方案时，在此文件顶部追加，保持时间倒序*
